{
  "name": "Seylane GPT Handler",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "replit",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "2c32aa3d-3d0f-4afd-a577-f886921d08ff",
      "name": "ðŸ“© Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1,
      "position": [
        0,
        0
      ],
      "webhookDescription": "Receives POST from Replit or Instagram agent",
      "webhookType": "default",
      "webhookId": "11efc966-207c-4e93-8af1-7fa3235c0158"
    },
    {
      "parameters": {
        "options": {
          "responseCode": 200
        }
      },
      "id": "b815ea70-8806-4a13-9ba1-2aa824b45630",
      "name": "ðŸ“¤ Return to Replit",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1,
      "position": [
        864,
        0
      ]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "={{ $json.messages[0].content }}"
            }
          ]
        },
        "jsonOutput": true,
        "options": {
          "systemMessage": "=act as alex hormozi and here is deal of seylane do what ever you can to make them join affiliate program Ø³Ù„Ø§Ù… ÙˆÙ‚ØªØªÙˆÙ† Ø¨Ø®ÛŒØ± ðŸŒ¿\nÛŒÙ‡ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ÙˆÛŒÚ˜Ù‡ Ø§Ø² Ø·Ø±Ù Ù‡Ù„Ø¯ÛŒÙ†Ú¯ Ø³ÛŒÙ„Ø§Ù†Ù‡ Ø³Ø¨Ø² Ø¯Ø§Ø±ÛŒÙ… Ø¨Ø±Ø§ØªÙˆÙ†!\nÙ…ÛŒâ€ŒØªÙˆÙ†ÛŒØ¯ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø¨Ø±Ù†Ø¯Ù‡Ø§ÛŒ MisswakeØŒ CollaminØŒ Ice BallØŒ Umbrella Ùˆ Dafi Ø±Ùˆ Ø¨Ø§ Ù‚ÛŒÙ…Øª Ù‡Ù…Ú©Ø§Ø± Ùˆ Ø®Ø±ÛŒØ¯ Ù…Ø³ØªÙ‚ÛŒÙ… Ø§Ø² Ø´Ø±Ú©Øª ØªÙ‡ÛŒÙ‡ Ú©Ù†ÛŒØ¯.\n\nÙØ±ÙˆØ´ Ø§ÛŒÙ† Ø¨Ø±Ù†Ø¯Ù‡Ø§ ØªÙˆÛŒ Ø§ÛŒÙ†Ø³ØªØ§Ú¯Ø±Ø§Ù… ÙˆØ§Ù‚Ø¹Ø§Ù‹ ØªØ±Ú©ÙˆÙ†Ø¯Ù‡ ðŸ’¥\nÙ‡Ø± Ù…Ø§Ù‡ ÙÙ‚Ø· Ø¨Ù‡ Û±Û° ÙØ±ÙˆØ´Ú¯Ø§Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø§ÛŒÙ† ÙØ±ØµØª Ø¯Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´Ù‡.\nÙ…Ø§ÛŒÙ„ÛŒØ¯ Ù„ÛŒÙ†Ú© Ø§Ø®ØªØµØ§ØµÛŒ Ø±Ùˆ Ø¨Ø±Ø§ØªÙˆÙ† Ø¨ÙØ±Ø³ØªÙ…ØŸ\nÙ…ÛŒ ØªÙˆÙ†Ù† Ú©ÙˆÙ¾Ù† Ø¨Ù‡ Ù†Ø§Ù… Ø®ÙˆØ¯Ø´ÙˆÙ† Ø§Ø² Û²Û° ØªØ§ Û´Û° Ø¯Ø±ØµØ¯ Ø¨Ú¯ÛŒØ±Ù† Ùˆ Ø³ÙˆØ¯ Ø¨Ú©Ù†Ù† \nthe only rule you have is to speak farsi and do your best",
          "codeExecution": false,
          "maxOutputTokens": 200
        }
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        256,
        0
      ],
      "id": "93624a91-cb7e-498c-b40d-752029dada91",
      "name": "Message a model",
      "alwaysOutputData": false,
      "credentials": {
        "googlePalmApi": {
          "id": "UT1iahfaFNxVbfVf",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ðŸ§  Seylane Gemini Output Cleaner v5 (Resilient Mode)\nlet raw = $json;\nlet text = \"\";\n\n// ðŸ©µ 1ï¸âƒ£ Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ù…Ø³ÛŒØ± Ù…Ø­ØªÙˆØ§\ntry {\n  if (raw[0]?.content?.parts?.[0]?.text) {\n    text = raw[0].content.parts[0].text;\n  } else if (raw.content?.parts?.[0]?.text) {\n    text = raw.content.parts[0].text;\n  } else if (typeof raw === \"string\") {\n    text = raw;\n  } else {\n    text = JSON.stringify(raw);\n  }\n} catch (e) {\n  text = JSON.stringify(raw);\n}\n\n// ðŸ©µ 2ï¸âƒ£ ØªÙ…ÛŒØ²Ø³Ø§Ø²ÛŒ\ntext = text\n  .replace(/```json/g, \"\")\n  .replace(/```/g, \"\")\n  .replace(/\\\\n/g, \" \")\n  .replace(/\\n/g, \" \")\n  .replace(/\\r/g, \"\")\n  .replace(/\\\\t/g, \"\")\n  .trim();\n\n// ðŸ©µ 3ï¸âƒ£ Ø§Ú¯Ø± JSON Ù†Ø§Ù‚Øµ Ø¨ÙˆØ¯ØŒ ØªÙ„Ø§Ø´ Ú©Ù† Ù…ØªÙ† Ø±Ùˆ Ù†Ø¬Ø§Øª Ø¨Ø¯Ù‡\nlet parsed = {};\ntry {\n  parsed = JSON.parse(text);\n} catch (err) {\n  // Ø§Ú¯Ø± JSON Ù†Ø§Ù‚Øµ Ø¨Ø§Ø´Ù‡ØŒ Ø³Ø¹ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø¨Ø®Ø´ message Ø±Ùˆ Ø¯Ø³ØªÛŒ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒÙ…\n  const match = text.match(/\"message\"\\s*:\\s*\"([^\"]+)/);\n  if (match && match[1]) {\n    parsed = { message: match[1] + \"...\" };\n  } else {\n    parsed = { message: text };\n  }\n  parsed.sendLink = false;\n}\n\n// ðŸ©µ 4ï¸âƒ£ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø§Ø² ÙˆØ¬ÙˆØ¯ ÙÛŒÙ„Ø¯ message\nif (!parsed.message || parsed.message.trim() === \"\") {\n  parsed.message = \"ðŸŒ¿ Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ù¾Ø§Ø³Ø® Ú©Ø§Ù…Ù„ Ø§Ø² Ù…Ø¯Ù„ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯ØŒ Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ù¾ÛŒØ§Ù… Ø¨Ø¯ÛŒØ¯.\";\n  parsed.sendLink = false;\n}\n\n// ðŸ©µ 5ï¸âƒ£ Ø®Ø±ÙˆØ¬ÛŒ Ù†Ù‡Ø§ÛŒÛŒ Ø·Ø¨Ù‚ Ø³Ø§Ø®ØªØ§Ø± n8n\nreturn [{ json: parsed }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        608,
        0
      ],
      "id": "97a49734-d8f7-4241-b5dd-48bddf264aaf",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "jsCode": "\nlet messages = $json.body.messages;\n\nif (!messages || messages.length === 0) {\n  return [{ json: { messages: [] } }];\n}\n\n// Find the last message from the user\nlet lastUserMessage = null;\nfor (let i = messages.length - 1; i >= 0; i--) {\n  if (messages[i].role === \"user\") {\n    lastUserMessage = messages[i];\n    break;\n  }\n}\n\nif (lastUserMessage) {\n  // Clean the content of the last user message if it's a string\n  if (typeof lastUserMessage.content === \"string\") {\n    try {\n      let parsedContent = JSON.parse(lastUserMessage.content);\n      if (parsedContent && typeof parsedContent.message === \"string\") {\n        lastUserMessage.content = parsedContent.message;\n      } else {\n        lastUserMessage.content = JSON.stringify(parsedContent);\n      }\n    } catch (e) {\n      const match = lastUserMessage.content.match(/\"message\"\\s*:\\s*\"([^\"]+)\"/);\n      if (match && match[1]) {\n        lastUserMessage.content = match[1];\n      }\n    }\n  }\n  return [{ json: { messages: [lastUserMessage] } }];\n} else {\n  return [{ json: { messages: [] } }];\n}\n"
      },
      "id": "generated-3d71ca89-47a7-47e3-9b88-2fbbcc3663c7",
      "name": "Clean Input Messages",
      "position": [
        256,
        208
      ],
      "type": "n8n-nodes-base.code",
      "typeVersion": 2
    }
  ],
  "pinData": {},
  "connections": {
    "ðŸ“© Webhook Trigger": {
      "main": [
        [
          {
            "node": "Clean Input Messages",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "ðŸ“¤ Return to Replit",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ðŸ“¤ Return to Replit": {
      "main": [
        []
      ]
    },
    "Clean Input Messages": {
      "main": [
        [
          {
            "node": "Message a model",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "09a93eed-f85e-4954-97bd-1c382120df4e",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "5cfa9f8bc11b37dae01ef5dcedf8817256d984894cfe15bd48dac87ef3a140ba"
  },
  "id": "Xv27ldY7GSbdJUt5",
  "tags": []
}